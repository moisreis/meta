<%= render 'partials/route/dashboard/wrapper',
           page_title: "Aplicação ##{@application.id}",
           page_desc: "Investimento em #{@application.fund_investment.investment_fund.fund_name}",
           current_view: "show" do
%>

  <%= render "partials/route/dashboard/section",
             section_title: "Informações da Aplicação",
             section_desc: "Dados da transação de investimento",
             columns: 4,
             has_action: false do
  %>

    <%= render "partials/route/dashboard/card",
               card_title: "Fundo de Investimento",
               card_icon: "building-2",
               status: :teal,
               card_data: @application.fund_investment.investment_fund.administrator_name do
    %>
      <%= normalize_text(@application.fund_investment.investment_fund.fund_name) %>
    <% end %>


    <%= render "partials/route/dashboard/card",
               card_title: "Percentual Alocado",
               card_icon: "percent" do
    %>
      <%= normalize_percentage(application_quota_availability(@application)[:percentage]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Carteira",
               card_icon: "wallet",
               card_data: @application.fund_investment.portfolio.user.full_name do
    %>
      <%= normalize_text(@application.fund_investment.portfolio.name) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Investimento Relacionado",
               card_icon: "link",
               card_data: normalize_card_percentage(@application.fund_investment.percentage_allocation),
               card_data_icon: "percent" do
    %>
      <%= normalize_text("Alocação #{@application.fund_investment.id}") %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Status da Aplicação",
               card_icon: card_icon_boolean_for(application_status_text(@application)[:completed]),
               status: card_status_boolean_for(application_status_text(@application)[:completed]) do
    %>
      <%= normalize_text(application_status_text(@application)[:detail_text]) %>
    <% end %>
  <% end %>

  <%= render "partials/route/dashboard/section",
             section_title: "Valores Financeiros",
             section_desc: "Montantes e cotações da aplicação",
             columns: 4 do
  %>

    <%= render "partials/route/dashboard/card",
               card_title: "Valor Financeiro Investido",
               card_icon: "banknote" do
    %>
      <%= normalize_currency(@application.financial_value) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Número de Cotas Adquiridas",
               card_icon: "coins" do
    %>
      <%= normalize_number(@application.number_of_quotas) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Valor da Cota na Aplicação",
               card_icon: "calculator" do
    %>
      <%= normalize_currency(@application.quota_value_at_application) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Valor Calculado da Cota",
               card_icon: "calculator" do
    %>
      <%= normalize_currency(@application.calculated_quota_value) %>
    <% end %>
  <% end %>

  <%= render "partials/route/dashboard/section",
             section_title: "Datas do Ciclo de Vida",
             section_desc: "Cronologia da aplicação",
             columns: 4 do
  %>

    <%= render "partials/route/dashboard/card",
               card_title: "Data de Solicitação",
               card_icon: "calendar-plus",
               card_data: normalize_card_time_ago(@application.request_date) do
    %>
      <%= normalize_date(@application.request_date) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Data de Cotização",
               card_icon: "calendar-check-2" do
    %>
      <%= normalize_date(@application.cotization_date) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Data de Liquidação",
               card_icon: "calendar-check-2" do
    %>
      <%= normalize_date(@application.liquidation_date) %>
    <% end %>
  <% end %>

  <%= render "partials/groups/table-list",
             section_title: "Alocações de Resgate",
             collection: @application.redemption_allocations.includes(redemption: { fund_investment: [:portfolio, :investment_fund] }),
             action_path: nil,
             action_name: nil,
             headers: [
               "Resgate",
               "Carteira",
               "Usuário",
               "Cotas Utilizadas",
               "Valor da Cota",
               "Valor Total",
               "Data de Resgate"
             ],
             column_icons: [
               "arrow-down-to-line",
               "wallet",
               "user",
               "percent",
               "calculator",
               "coins",
               "calendar-check-2"
             ],
             body_procs: [
               ->(alloc) do
                 normalize_title("Resgate ##{alloc.redemption.id}")
               end,
               ->(alloc) do
                 normalize_fk(alloc.redemption.fund_investment.portfolio.name)
               end,
               ->(alloc) do
                 normalize_text(alloc.redemption.fund_investment.portfolio.user.full_name)
               end,
               ->(alloc) do
                 normalize_number(alloc.quotas_used)
               end,
               ->(alloc) do
                 normalize_currency(alloc.application.quota_value_at_application)
               end,
               ->(alloc) do
                 normalize_currency(alloc.cost_basis)
               end,
               ->(alloc) do
                 normalize_date(alloc.redemption.request_date)
               end,
             ]
  %>
<% end %>
