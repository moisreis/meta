<%= render 'partials/route/dashboard/wrapper',
           page_title: "Lista de Alocações",
           page_desc: "Acompanhe como os fundos estão distribuídos entre as carteiras.",
           current_view: "datatable" do
%>
  <%= render partial: "partials/blocks/data-table", locals: {

    columns_header: [
      "Fundo",
      "Carteira",
      "Alocação",
      "Valor investido",
      "Cotas totais",
      "Criado em",
      "Retorno"
    ],

    columns_icons: [
      "wallet",
      "layers",
      "shuffle",
      "banknote",
      "percent",
      "calendar",
      "trending-up"
    ],

    columns_body: [

      ->(fi) do
        normalize_title(fi.investment_fund&.fund_name)
      end,

      ->(fi) do
        normalize_fk(fi.portfolio&.name)
      end,

      ->(fi) do
        normalize_percentage(fi.percentage_allocation)
      end,

      ->(fi) do
        normalize_currency(fi.total_invested_value)
      end,

      ->(fi) do
        normalize_number(fi.total_quotas_held)
      end,

      ->(fi) do
        normalize_date(fi.created_at)
      end,

      ->(fi) do
        normalize_trend(fi.return_percentage, format: :percentage)
      end
    ],

    models: @fund_investments,

    sort_options: [],

    q_object: @q,

    search_url: fund_investments_path,

    turbo_frame_id: "fund_investments_table",

    export_url: export_fund_investments_path(request.query_parameters.slice('q'))
  } %>
<% end %>
<%= render partial: "partials/route/dashboard/filters", locals: {

  q_object: @q,

  search_url: fund_investments_path,

  filters: [
    {
      key: :portfolio_name_cont,
      label: "Carteira",
      description: "Exibe alocações vinculadas a carteiras cujo nome corresponda.",
      placeholder: "Nome da carteira",
      icon_name: "wallet"
    },
    {
      key: :investment_fund_fund_name_cont,
      label: "Fundo",
      description: "Filtra alocações pelo fundo investido.",
      placeholder: "Nome do fundo",
      icon_name: "chart-pie"
    },
    {
      key: :percentage_allocation_gteq,
      label: "Alocação",
      description: "Exibe alocações com percentual igual ou superior ao informado.",
      placeholder: "Percentual mínimo",
      icon_name: "badge-percent"
    },
    {
      key: :total_invested_value_gteq,
      label: "Valor investido",
      description: "Filtra alocações com valor investido acima do indicado.",
      placeholder: "Valor mínimo",
      icon_name: "banknote"
    }
  ],

  turbo_frame_id: "fund_investments_table"
} %>