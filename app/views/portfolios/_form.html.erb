<%#
  # Partial: _form.html
  # Date: 11/20/2025
  # Author: Moisés Reis
  # Package: Portfolio
  #
  # Description: Defines the input structure and submission mechanism for the Portfolio resource.
  #              It includes the required fields, automatically sets the associated user ID,
  #              and provides a customized submit button.
  #
  # Usage: - What: Renders the standardized form necessary for creating or updating
  #                a Portfolio object. It requires the 'portfolio' model instance
  #                to be passed as a local variable.
  #        - How: Utilizes the Rails `form_with` helper. Renders a reusable
  #               `_input-field` partial for the name. The user association
  #               is managed via a hidden field set to `current_user.id`.
  #        - Why: Provides a consistent and reusable input mechanism for the
  #               Portfolio resource, abstracting the form layout and guaranteeing
  #               the correct user association for data integrity.
  %>
<%= form_with(model: portfolio, class: "contents") do |form| %>
  <%= render "partials/modules/input-field",
             f: form,
             name: :name,
             label: "Nome da carteira",
             placeholder: "Carteira de Longo Prazo",
             is_half_width: true,
             desc: "Escolha um nome claro e descritivo.",
             field_type: :text_field,
             icon_name: "wallet"
  %>
  <%= render "partials/modules/separator" %>

<%# [Variable] Initializes `available_users_for_sharing`.
  #            It selects all User IDs and their full names (concatenated in the database)
  #            except the current user, ensuring optimal performance via SQL.
  %>
  <% available_users_for_sharing ||= User
    .where.not(id: current_user.id)
    .pluck(Arel.sql("CONCAT_WS(' ', first_name, last_name)"), :id)
  %>
  <%= render "partials/modules/select",
             f: form,
             name: :shared_user_id,
             label: "Compartilhar com usuário",
             desc: "Selecione um usuário para conceder acesso de leitura ou edição.",
             options_collection: options_for_select(available_users_for_sharing),
             include_blank: "Nenhum usuário para compartilhar",
             is_half_width: true
  %>
  <%= render "partials/blocks/radio-group",
             title: "Permissão de acesso",
             desc: "Escolha o nível de acesso para ceder ao usuário acima." do %>
    <%= render "partials/modules/radio",
               f: form,
               name: :grant_crud_permission,
               value: "read",
               title: "Leitura",
               desc: "O usuário pode apenas visualizar o portfólio e os ativos.",
               icon_name: "visibility"
    %>
    <%= render "partials/modules/radio",
               f: form,
               name: :grant_crud_permission,
               value: "crud",
               title: "Edição e Remoção",
               desc: "O usuário pode adicionar, editar e remover ativos.",
               icon_name: "edit_square"
    %>
  <% end %>
  <%= form.hidden_field :user_id,
                        value: current_user.id
  %>
  <%= form.button :submit,
                  name: nil,
                  class: "button button-primary w-fit flex items-center gap-2" do
  %>
    <%= inline_svg_tag "icons/#{icon_name}.svg" %>
    <%= content_tag :span, button_name %>
  <% end %>
<% end %>