<%= render 'partials/route/dashboard/wrapper',
           page_title: @economic_index.abbreviation,
           page_desc: "#{@economic_index.name}",
           current_view: "show" do
%>

  <%= render "partials/route/dashboard/section",
             section_title: "Métricas Atuais",
             section_desc: "Valor mais recente e estatísticas de dados",
             columns: 4 do
  %>

    <%= render "partials/route/dashboard/card",
               card_title: "Valor Atual",
               card_icon: "trending-up",
               status: :teal do
    %>
      <%= normalize_number(economic_index_statistics(@economic_index)[:latest_value]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Registros Históricos",
               card_icon: "database" do
    %>
      <%= normalize_number(economic_index_metadata(@economic_index)[:records_count]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Primeiro Registro",
               card_icon: "calendar" do
    %>
      <%= normalize_date(economic_index_metadata(@economic_index)[:first_record_date]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Última Atualização",
               card_icon: "calendar" do
    %>
      <%= normalize_date(economic_index_metadata(@economic_index)[:last_record_date]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Cadastrado em",
               card_icon: "calendar-plus" do
    %>
      <%= normalize_date(economic_index_metadata(@economic_index)[:created_at]) %>
    <% end %>
  <% end %>

  <%= render "partials/route/dashboard/section",
             section_title: "Visualizações",
             columns: 2 do
  %>

    <%= render "partials/groups/chart-list",
               chart_type: :line_chart,
               data_source: economic_index_chart_data(@economic_index)[:twelve_months],
               chart_title: "Histórico (12 Meses)",
               chart_options: {
                 thousands: ".",
                 decimal: ",",
                 curve: true,
                 library: {
                   scales: {
                     y: {
                       ticks: {
                         callback: "function(value) { return value.toLocaleString('pt-BR'); }"
                       }
                     }
                   }
                 }
               }
    %>

    <%= render "partials/groups/chart-list",
               chart_type: :line_chart,
               data_source: economic_index_chart_data(@economic_index)[:thirty_days],
               chart_title: "Histórico (30 Dias)",
               chart_options: {
                 thousands: ".",
                 decimal: ",",
                 curve: true,
                 library: {
                   scales: {
                     y: {
                       ticks: {
                         callback: "function(value) { return value.toLocaleString('pt-BR'); }"
                       }
                     }
                   }
                 }
               }
    %>

  <% end %>

  <%= render "partials/route/dashboard/section",
             section_title: "Análise Estatística",
             section_desc: "Métricas calculadas sobre o histórico de valores",
             columns: 4 do
  %>

    <%= render "partials/route/dashboard/card",
               card_title: "Valor Mínimo",
               card_icon: "arrow-down" do
    %>
      <%= normalize_number(economic_index_statistics(@economic_index)[:min_value]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Valor Máximo",
               card_icon: "arrow-up" do
    %>
      <%= normalize_number(economic_index_statistics(@economic_index)[:max_value]) %>
    <% end %>

    <%= render "partials/route/dashboard/card",
               card_title: "Média (12 meses)",
               card_icon: "activity" do
    %>
      <%= normalize_number(economic_index_statistics(@economic_index)[:avg_12_months]) %>
    <% end %>
  <% end %>

  <%= render "partials/groups/table-list",
             section_title: "Artigos Normativos Relacionados",
             collection: economic_index_related_articles(@economic_index),
             action_path: nil,
             action_name: nil,
             headers: ["Artigo", "Número", "Meta de Benchmark", "Descrição"],
             column_icons: ["file-text", "hash", "target", "info"],
             body_procs: [
               ->(article) do
                 normalize_title(article.display_name)
               end,
               ->(article) do
                 normalize_text(article.article_number.presence)
               end,
               ->(article) do
                 normalize_number(article.benchmark_target)
               end,
               ->(article) do
                 normalize_text(article.description)
               end,
             ]
  %>

  <%= render "partials/groups/table-list",
             section_title: "Histórico de Valores",
             collection: economic_index_recent_values(@economic_index),
             action_path: nil,
             action_name: nil,
             headers: ["Data", "Valor", "Variação", "Registrado em"],
             column_icons: ["calendar", "dollar-sign", "trending-up-down", "clock"],
             body_procs: [
               ->(val) do
                 normalize_date(val.date)
               end,
               ->(val) do
                 normalize_number(val.value)
               end,
               ->(val) do
                 change = economic_index_value_change(@economic_index, val)

                 normalize_trend(change, format: :percentage)
               end,
               ->(val) do
                 normalize_date(val.date)
               end
             ]
  %>
<% end %>
