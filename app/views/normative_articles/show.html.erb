<%#
  # Partial: show.html.erb
  # Date: 12/4/2025
  # Author: Moisés Reis
  # Package: Meta
  #
  # Description: Displays the detailed view for a single normative article.
  #              It consolidates article information, benchmark data, associated
  #              investment funds, and metadata in a structured dashboard layout.
  #
  # Usage: - What: Renders the comprehensive detail page for a specific normative article.
  #                It allows users to review article content, benchmark targets, and related funds.
  #        - How: This partial is rendered from the NormativeArticlesController#show action, receiving
  #               the @normative_article instance variable, which represents the complete article record.
  #        - Why: Provides a single, centralized view for reviewing regulatory content, monitoring
  #               benchmark compliance, and understanding which funds follow this article.
  %>

<%# Explanation:: This layout wrapper organizes the entire page content into a clean
  #               dashboard structure. It displays the article name and identifies
  #               it as a normative article for clear context.
  %>
<%= render 'partials/route/dashboard/wrapper',
           page_title: @normative_article.display_name,
           page_desc: "Artigo Normativo",
           current_view: "show" do
%>

  <%# Explanation:: This section groups the primary identification data and administrative
    #               actions for the article. It provides a quick-access "Edit" button and
    #               works by organizing cards into a responsive grid for easy scanning.
    %>
  <%= render "partials/route/dashboard/section",
             section_title: "Visão Geral",
             section_desc: "Informações básicas do artigo normativo",
             columns: 4,
             has_action: true,
             button_route: edit_normative_article_path(@normative_article),
             button_name: "Editar",
             button_icon: "pencil" do
  %>

    <%# Explanation:: This card displays the formal reference code or number assigned to
      #               the article in official records. It serves as the unique identifier
      #               for regulatory tracking and ensures the user can cross-reference laws.
      %>
    <%= render "partials/route/dashboard/card",
               card_title: "Número do Artigo",
               card_icon: "file-text" do
    %>
      <%= normalize_text(@normative_article.article_number.presence) %>
    <% end %>

    <%# Explanation:: This card presents the human-readable name of the normative rule to
      #               provide immediate clarity on its subject. It pulls the title directly
      #               from the database and ensures the regulatory topic is prominent.
      %>
    <%= render "partials/route/dashboard/card",
               card_title: "Nome do Artigo",
               card_icon: "file-check" do
    %>
      <%= normalize_text(@normative_article.article_name.presence) %>
    <% end %>

    <%# Explanation:: This card shows the specific percentage target used as a performance
      #               benchmark for this rule. It highlights the compliance goal and
      #               works by applying success styling when a value is actively defined.
      %>
    <%= render "partials/route/dashboard/card",
               card_title: "Meta de Benchmark",
               card_icon: "target",
               status: card_status_boolean_for(@normative_article.has_benchmark?) do
    %>
      <%= normalize_number(@normative_article.benchmark_target) %>
    <% end %>

    <%# Explanation:: This numeric card tracks how many different investment funds are
      #               currently governed by this article. It provides a measure of the
      #               article's impact by counting its associations within the system.
      %>
    <%= render "partials/route/dashboard/card",
               card_title: "Fundos Vinculados",
               card_icon: "coins" do
    %>
      <%= normalize_number(@normative_article.investment_funds.count) %>
    <% end %>
  <% end %>

  <%# Explanation:: This table lists every fund that must comply with this normative
    #               article, providing details like CNPJ and custom notes. It is
    #               used for auditing fund relationships and works by iterating through links.
    %>
  <%= render "partials/groups/table-list",
             section_title: "Fundos de Investimento Vinculados",
             collection: @normative_article.investment_fund_articles.includes(investment_fund: :fund_investments),
             action_path: nil,
             action_name: nil,
             headers: [
               "Fundo",
               "CNPJ",
               "Administrador",
               "Observações"
             ],
             column_icons: [
               "layers",
               "id-card",
               "user-cog",
               "info"
             ],
             body_procs: [
               ->(ifa) do
                 normalize_title(ifa.investment_fund.fund_name)
               end,
               ->(ifa) do
                 normalize_code(ifa.investment_fund.cnpj)
               end,
               ->(ifa) do
                 normalize_text(ifa.investment_fund.administrator_name)
               end,
               ->(ifa) do
                 normalize_text(ifa.note.presence)
               end,
             ]
  %>
<% end %>