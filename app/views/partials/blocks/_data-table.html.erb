<%#
  # Partial: _data-table.html
  # Date: 11/20/2025
  # Author: MoisÃ©s Reis
  # Package: Meta
  #
  # Description: Renders a complete data-table interface that includes filters,
  #              export actions, pagination and a Turbo Frame for async updates.
  #              Organizes UI controls clearly to guide the user through table
  #              interactions.
  #
  # Usage: - What: Displays filter controls when a q_object is present.
  #                Renders the table via a nested partial with dynamic columns.
  #                Shows pagination below the main frame.
  #        - How:  Call this partial from any view where you need a full
  #                data-table container with filters and pagination.
  #                Provide the locals: columns_header, columns_icons,
  #                columns_body, models, and optionally q_object.
  #        - Why:  Centralizes table UI logic in one reusable layout.
  #                Keeps views clean and ensures consistent behavior across
  #                different tables in the application.
  %>
<div class="flex flex-col gap-3">

  <% content_for :page_total do %>
    <%= models.respond_to?(:total_count) ? models.total_count : models.size %>
  <% end %>

  <%# [Condition] Checks if q_object exists.
    #             Shows the filter and export controls when the condition is true.
    %>
  <% if q_object %>
    <div class="flex flex-row [&>div]:flex [&>div]:flex-row [&>div]:gap-1.5 [&>div]:items-center justify-between items-center gap-6">
      <div class="justify-start">
        <%= link_to search_url,
                    class: "button button-outline button-small",
                    data: { turbo_frame: turbo_frame_id } do
        %>
          <%= inline_svg_tag "icons/refresh-cw.svg" %>
          <%= content_tag :span, "Limpar filtros" %>
        <% end %>
        <div class="h-4 w-[1px] bg-border"></div>
        <%= button_tag id: "openFiltersBtn",
                       class: "button button-outline button-small" do
        %>
          <%= inline_svg_tag "icons/sliders-horizontal.svg" %>
          <%= content_tag :span, "Ver filtros" %>
        <% end %>
        <div class="h-4 w-[1px] bg-border"></div>
        <%= link_to defined?(new_path) ? new_path : new_polymorphic_path(models.klass),
                    class: "button button-accent button-small",
                    data: { turbo_frame: turbo_frame_id } do %>
          <%= inline_svg_tag "icons/plus.svg" %>
          <%= content_tag :span, "Adicionar item" %>
        <% end %>
      </div>
      <div class="justify-end">
        <% if export_url.present? %>
          <%= link_to export_url,
                      class: "button button-secondary button-small",
                      target: "_blank",
                      data: { turbo: false } do
          %>
            <%= inline_svg_tag "icons/file-chart-column.svg" %>
            <%= content_tag :span, "Exportar" %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
  <turbo-frame id="<%= turbo_frame_id %>">
    <%= render partial: "partials/modules/table", locals: {
      columns_header: columns_header,
      columns_icons: columns_icons,
      columns_body: columns_body,
      models: models
    } %>
  </turbo-frame>
  <div class="flex justify-start px-3 mt-3">
    <%= paginate models %>
  </div>
</div>