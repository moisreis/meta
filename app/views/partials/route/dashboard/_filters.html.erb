<%#
  # Partial: _filters.html.erb
  # Date: 11/20/2025
  # Author: MoisÃ©s Reis
  # Package: Meta
  #
  # Description: This partial builds a sliding sidebar that contains search
  #              options. It allows users to refine the data they see on
  #              the screen by filling out dynamic form fields.
  #
  # Usage: - What: It creates a dedicated area for search filters that
  #                appears over the main content when needed.
  #        - How: It takes a list of filter settings and transforms
  #               them into input boxes. It uses **Ransack** and
  #               **Turbo Frames** to update results instantly.
  #        - Why: It keeps the main interface clean by hiding complex
  #               search options inside a reusable sidebar.
  %>
<div id="sidebarFilters" class="absolute h-[80%] top-1/2 right-1/2 rounded-base translate-x-1/2 -translate-y-1/2 bg-accent w-[50%] bg-white shadow-sm border border-border z-50 transition-opacity ease-in-out">

  <%# Explanation:: This block creates the actual search form structure.
    #               It captures the user's choices and sends them to the
    #               server to update the list of items being viewed.
    %>
  <%= search_form_for q_object,
                      url: search_url,
                      method: :get,
                      html: { id: "filter_form", class: "flex flex-col h-full" },
                      data: { turbo_frame: turbo_frame_id } do |f| %>

    <div class="h-12 flex flex-row justify-between items-center px-3 border-b border-border">

      <h3 class="text-heading font-heading font-medium text-left">Filtros</h3>

      <%= button_tag id: "closeFiltersBtn",
                     type: "button",
                     class: "button button-ghost button-small" do
      %>
        <%= inline_svg_tag "icons/x.svg" %>
      <% end %>
    </div>

    <div class="flex-grow px-6 space-y-6 overflow-y-auto">

      <%# Explanation:: This loop goes through each requested filter setting.
        #               For every item in the list, it draws a labeled
        #               input box so the user can type their search criteria.
        %>
      <% filters.each do |filter| %>
        <%= render partial: "partials/modules/input-field", locals: {
          f: f,
          name: filter[:key],
          label: filter[:label],
          desc: filter[:description],
          placeholder: filter[:placeholder],
          field_type: :text_field,
          is_half_width: false,
          icon_name: filter[:icon_name],
        } %>
      <% end %>

      <div class="flex flex-row gap-1.5">
        <%= button_tag type: :submit,
                       class: "button button-secondary",
                       id: "applyFiltersBtn" do
        %>
          <%= inline_svg_tag "icons/funnel.svg" %>
          <%= content_tag :span, "Aplicar" %>
        <% end %>

        <%# Explanation:: This link resets the search by reloading the page.
          #               It points back to the base search URL to clear
          #               away any active filters or keywords.
          %>
        <%= link_to search_url,
                    class: "button button-outline",
                    data: { turbo_frame: turbo_frame_id } do
        %>
          <%= inline_svg_tag "icons/refresh-cw.svg" %>
          <%= content_tag :span, "Limpar" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<%# Explanation:: This hidden layer sits behind the filter sidebar.
  #               It darkens the background when the filters are open
  #               to help the user focus on the search options.
  %>
<div class="h-screen w-screen bg-body/10 z-40 hidden absolute top-0 right-0" id="filterOverlay"></div>