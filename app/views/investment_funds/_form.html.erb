<%#
  # Partial: _form.html.erb
  # Date: 02/23/2026
  # Author: Moisés Reis
  # Package: Meta
  #
  # Description: This file renders the core form fields necessary for
  #              creating or editing an **InvestmentFund** record.
  #              It handles naming, administration, and regulatory data.
  #
  # Usage:: - What: Displays structured input fields required to capture
  #                all mandatory metadata for an investment fund.
  #         - How: Utilizes the **form_with** helper and nested partials
  #                like **input-field** to generate the UI components.
  #         - Why: Centralizes fund data input, ensuring consistency
  #                across both the new and edit views of the application.
  %>

<%# Explanation:: This tag initializes the form to capture and send fund
  #               data to the server; it is used during creation or editing
  #               and works by binding input fields to the InvestmentFund model.
  %>
<%= form_with(model: investment_fund, class: "contents") do |form| %>

  <%# Explanation:: This layout block groups identity fields to keep the
    #               interface organized; it is used to separate official registration
    #               data and works by rendering a titled section around the inputs.
    %>
  <%= render "partials/blocks/fieldset",
             fieldset_title: "Identificação do Fundo",
             fieldset_desc: "Defina o nome principal e as informações de registro do fundo." do %>

    <%# Explanation:: This module creates a text box for the user to type the
      #               fund's commercial name; it is used to label the asset and
      #               works by rendering a standard HTML input with a folder icon.
      %>
    <%= render "partials/modules/input-field",
               f: form,
               name: :fund_name,
               label: "Nome do Fundo",
               placeholder: "Fundo de Investimento XYZ",
               desc: "Nome comercial do fundo.",
               field_type: :text_field,
               icon_name: "folder-open"
    %>

    <%# Explanation:: This line provides a field for the official tax number to
      #               ensure regulatory compliance; it is used for unique identification
      #               and works by capturing the numeric CNPJ sequence for the record.
      %>
    <%= render "partials/modules/input-field",
               f: form,
               name: :cnpj,
               label: "CNPJ",
               placeholder: "00.000.000/0000-00",
               desc: "O CNPJ precisa ser único no sistema.",
               field_type: :text_field,
               icon_name: "hash"
    %>
  <% end %>

  <%# Explanation:: This layout block separates the financial cost information to
    #               provide clarity on fund fees; it is used to manage profitability
    #               expectations and works by grouping tax-related input fields.
    %>
  <%= render "partials/blocks/fieldset",
             fieldset_title: "Custos e Indicadores",
             fieldset_desc: "Determine as taxas de serviço e o índice de comparação de rendimento." do %>

    <%# Explanation:: This field captures the annual percentage cost for managing
      #               the fund's operations; it is used to calculate net returns
      #               and works by storing a decimal value representing the yearly fee.
      %>
    <%= render "partials/modules/input-field",
               f: form,
               name: :administration_fee,
               label: "Taxa de Administração (%)",
               placeholder: "0.50",
               desc: "Percentual cobrado anualmente pela gestão.",
               field_type: :number_field,
               step: 0.0001,
               icon_name: "percent"
    %>

    <%# Explanation:: This input records the bonus fee paid when the fund beats its
      #               target; it is used to define incentive costs for the manager
      #               and works by capturing the percentage over the benchmark.
      %>
    <%= render "partials/modules/input-field",
               f: form,
               name: :performance_fee,
               label: "Taxa de Performance (%)",
               placeholder: "20.00",
               desc: "Percentual cobrado sobre o que exceder o benchmark.",
               field_type: :number_field,
               step: 0.0001,
               icon_name: "trending-up"
    %>

    <%# Explanation:: This text field identifies the economic index used for
      #               performance comparison; it is used to measure success
      #               and works by linking the fund to an index like CDI or IPCA.
      %>
<%# Explanation:: This select links the fund to a registered EconomicIndex record
  #               by its abbreviation, ensuring that grouping and reporting logic
  #               always finds a matching index in the database.
  %>
    <div class="flex flex-col gap-1">
      <%= form.label :benchmark_index, "Índice de Referência", class: "label" %>
      <%= form.select :benchmark_index,
                      options_for_select(
                        EconomicIndex.order(:abbreviation).map { |i| [i.abbreviation, i.abbreviation] },
                        investment_fund.benchmark_index
                      ),
                      { include_blank: "Nenhum / Não aplicável" },
                      class: "input" %>
      <p class="text-xs text-muted-foreground">
        Indicador utilizado para comparar a rentabilidade.
      </p>
      <% if investment_fund.errors[:benchmark_index].any? %>
        <p class="text-xs text-destructive">
          <%= investment_fund.errors[:benchmark_index].first %>
        </p>
      <% end %>
    </div>
  <% end %>

  <%# Explanation:: This group organizes management settings to clarify who is
    #               responsible for the fund; it is used to track administrators
    #               and works by placing responsibility fields in a distinct section.
    %>
  <%= render "partials/blocks/fieldset",
             fieldset_title: "Gestão e Origem",
             fieldset_desc: "Informe as entidades responsáveis pela administração e a procedência do fundo." do %>

    <%# Explanation:: This input allows the user to specify the managing institution
      #               to ensure accountability; it is used for administrative tracking
      #               and works by storing the institution's name in the fund record.
      %>
    <%= render "partials/modules/input-field",
               f: form,
               name: :administrator_name,
               label: "Administrador",
               placeholder: "Nome da instituição administradora",
               desc: "Nome da entidade responsável pela administração.",
               field_type: :text_field,
               icon_name: "id-card"
    %>

    <%# Explanation:: This field identifies if the asset belongs to a parent fund
      #               to show structural relationships; it is used for lineage
      #               mapping and works by capturing the name of the source entity.
      %>
    <%= render "partials/modules/input-field",
               f: form,
               name: :originator_fund,
               label: "Fundo originador",
               placeholder: "Nome do fundo originador",
               desc: "Informe caso este fundo seja derivado de outro.",
               field_type: :text_field,
               icon_name: "arrow-left-right"
    %>
  <% end %>

  <%# Explanation:: This section defines the legal rules that govern the fund
    #               to ensure transparency; it is used for compliance auditing
    #               and works by linking the fund to specific normative articles.
    %>
  <%= render "partials/blocks/fieldset",
             fieldset_title: "Regulamentação",
             fieldset_desc: "Selecione as diretrizes e artigos normativos que regem este fundo." do %>

    <%# Explanation:: This module renders a selection menu to link legal articles
      #               to the current fund; it is used to define regulatory limits
      #               and works by listing all available articles from the database.
      %>
    <%= render "partials/modules/select",
               f: form,
               name: :normative_article_ids,
               label: "Artigos Normativos",
               options_collection: NormativeArticle.all.map { |article| [article.article_name, article.id] },
               desc: "Selecione os artigos normativos que regulam este fundo."
    %>
  <% end %>

  <%# Explanation:: This button triggers the submission to save all entered
    #               information; it is used to complete the form process and
    #               works by sending the gathered data to the server via a click.
    %>
  <%= form.button :submit,
                  name: nil,
                  class: "button button-primary w-fit flex items-center gap-2" do
  %>
    <%= inline_svg_tag "icons/#{icon_name}.svg" %>
    <%= content_tag :span, button_name %>
  <% end %>
<% end %>




